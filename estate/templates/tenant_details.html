{% extends "base.html" %} {% load currency %} {% block content %}

<div class="dashboard-card mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="dashboard-title mb-0">
      {{ tenant.name }} {% if tenant.active %}
      <span class="badge bg-success ms-2">Active</span>
      {% else %}
      <span class="badge bg-secondary ms-2">Inactive</span>
      {% endif %}
    </h2>
    <a
      href="{% url 'edit_tenant' tenant.id %}"
      class="btn btn-outline-main btn-sm"
    >
      Edit Tenant
    </a>
  </div>

  <p class="text-muted mb-1">
    <strong>Property:</strong> {{ tenant.property.name }}
  </p>
  <p class="text-muted mb-1">
    <strong>Start Date:</strong> {{ tenant.start_date }}
  </p>

  {% if tenant.phone %}
  <p class="text-muted mb-1"><strong>Contact:</strong> {{ tenant.phone }}</p>
  {% elif tenant.email %}
  <p class="text-muted mb-1"><strong>Contact:</strong> {{ tenant.email }}</p>
  {% endif %} {% if tenant.end_date %}
  <p class="text-muted"><strong>End Date:</strong> {{ tenant.end_date }}</p>
  {% endif %}
</div>

<div class="dashboard-card mb-4">
  <h4 class="dashboard-title mb-2">Current Rent</h4>
  <p class="mb-1"><strong>{{ current_rent|ugx }}</strong> per month</p>
  <small class="text-muted">
    Effective from {{ current_rent_effective|date:"F Y" }}. Rent changes do not
    affect previously paid months.
  </small>
</div>

<div class="dashboard-card mb-4">
  <h4 class="dashboard-title mb-2">Outstanding Balance (Current)</h4>

  {% if outstanding_balance > 0 %}
  <p class="fw-bold text-danger mb-1">{{ outstanding_balance|ugx }}</p>
  <small class="text-muted"> Status: {{ payment_status }} </small>
  {% if not tenant.active %}
  <div class="mt-3">
    <a href="/payments/add/?tenant={{ tenant.id }}" class="btn btn-main btn-sm">
      Add Payment
    </a>
  </div>
  {% endif %} {% else %}
  <p class="fw-bold text-success mb-1">No outstanding balance</p>
  <small class="text-muted"> Status: On Time </small>
  {% endif %}
</div>

<div class="dashboard-card mb-4">
  <h4 class="dashboard-title mb-3">Payment History</h4>

  {% if payments %}
  <table class="table table-custom">
    <thead>
      <tr>
        <th>Date Paid</th>
        <th>Payment For</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
      <tr>
        <td>{{ p.date_paid }}</td>
        <td>{{ p.payment_month|date:"F Y" }}</td>
        <td>{{ p.amount|ugx }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-muted">No payments recorded for this tenant.</p>
  {% endif %}
</div>

<div class="d-flex gap-3 align-items-center">
  <a href="{% url 'tenants' %}" class="btn btn-outline-main">
    â† Back to Tenants
  </a>

  <form method="post" action="{% url 'toggle_tenant_active' tenant.id %}">
    {% csrf_token %} {% if tenant.active %}
    <button type="submit" class="btn btn-outline-danger">
      Deactivate Tenant
    </button>
    {% else %}
    <button type="submit" class="btn btn-outline-success">
      Activate Tenant
    </button>
    {% endif %}
  </form>
</div>

{% endblock %}
